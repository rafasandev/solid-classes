ANOTAÇÕES GERAIS

- Ao criar um usuário novo, ele pode ser tanto um comprador quanto um vendedor. Informações básicas para um usuário: email, senha e status.
- Se for um comprador, as informações adicionais do perfil são: nome e cpf.
- Se for um vendedor, as informações adicionais são: nome da loja, cnpj e setor de atuação (Comércio ou Serviço).

- comprador
    - Ao registrar um novo comprador, um novo carrinho vazio é criado, vinculado ao ID do usuário
    - Ao finalizar um pedido, o carrinho do comprador é esvaziado e atualizado, nunca deletado
    - O novo comprador é registrado com o status inativo, devendo completar o perfil com ao menos um meio de contato
- vendedor
    - O vendedor é registrado com informações básicas, mas status inativo. Só será dado como ativo após configurar disponibilidade e ao menos um meio de contato (DESENVOLVIMENTO PENDENTE)
    - O vendedor é registrado com um saldo inicial de 0
    - Os meios de pagamento serão configurados com o envio da seguinte estrutura de dados:
        paymentMethodIds: [uuid, uuid, uuid, ...]
    - A disponibilidade do vendedor será configurada com o envio da seguinte estrutura de dados:
        weekDaysAvailable : [1,2,3,4,5] (1=Domingo, 2=Segunda, ..., 7=Sábado)
        dailyAvailability(List<CompanyDailyAvailabilityForm>): [
            {
                weekDay: 1,
                timeRanges (List<TimeRangeForm>): [
                    {
                        startTime: "08:00",
                        endTime: "12:00"
                    },
                    {
                        startTime: "14:00",
                        endTime: "18:00"
                    }
                ]
            },
            {
                weekDay: 2,
                timeRanges (List<TimeRangeForm>): [
                    {
                        startTime: "09:00",
                        endTime: "17:00"
                    }
                ]
            }
        ]

- Ambos perfis devem configurar ao menos um meio de contato para serem ativados
- Depois da configuração dos perfis, o status dos usuários deve ser alterado para ATIVO
- A verificação do status ativo/inativo é feita com um método interno no modelo do Profile (individualIsAbleToBeActive e companyIsAbleToBeActive)
- Para evitar duplicação de código, a verificação será feita no serviço de salvamento do perfil, em IndividualProfileService e CompanyProfileService

- Apenas ADMINS podem criar categorias de produtos no sistema
- Produtos são criados com: nome, descrição, preço base, quantidade em estoque e categoria
- Produtos não podem ser criados com variações inicialmente

- O cálculo de quantidade de estoque do produto é feito de forma automática no Service dele, não sendo alterado por métodos internos
- A quantidade é calculada com base nas quantidades individuais das variações de produto

- Ao requisitar o fechamento do pedido, o sistema deve:
    - Verificar se o usuário atual logado é um comprador
    - Buscar o carrinho do comprador
    - Validar se o carrinho não está vazio
    - Validar se os itens (product variations) estão disponíveis e com estoque suficiente
    - Separa os itens por vendedor (Map <CompanyProfile, List<CartItem>>)
    - O pedido original será repartido para vários pedidos, um para cada vendedor
    - Para cada item do mapa, será calculado o total parcial daquele vendedor
    - Será criado um Order para o vendedor, com o status PENDENTE e o código de confirmação único
    - Será criado um snapshot dos itens do pedido, vinculados ao pedido
    - O estoque dos produtos será ajustado conforme os itens do pedido
    - O carrinho do comprador será esvaziado e atualizado
    - Todos os dados dos itens do pedido serão persistidos nos snapshots, para evitar perda de dados futuros

- O pedido passa por várias etapas de status:
    - PENDENTE, // Pedido Gerado
        - O pedido é criado com esse status, aguardando confirmação do vendedor para prosseguir
    
    - PEDIDO_CANCELADO, // Pedido cancelado enquanto está pendente (Sem penalização)
        - O pedido pode ser cancelado pelo vendedor ou comprador nessa etapa, antes de ser pago ou estar pronto para a retirada.
        - O pedido de cancelamento pode ser feito por meio de contato externo (chat, email, telefone) e o vendedor pode atualizar o status para PEDIDO_CANCELADO

    - PROCESSANDO, // Pedido em processamento
        - O vendedor confirmou o recebimento do pedido e está preparando-o ou separando itens para retirada
    
    - CANCELADO_PROCESSANDO, // Pedido cancelado durante o processamento (Penalização de 1 ponto)
        - O pedido pode ser cancelado pelo vendedor nessa etapa, antes de estar pronto para a retirada.
        - O pedido de cancelamento pode ser feito por meio de contato externo (chat, email, telefone) e o vendedor pode atualizar o status para CANCELADO_PROCESSANDO

    - PRONTO_RETIRADA, // Aguardando o cliente buscar
        - O pedido está pronto para ser retirado pelo cliente no local do vendedor
        - O cliente deve retirar o pedido dentro do prazo estabelecido pelo vendedor
        - Se o cliente não retirar o pedido dentro do prazo, o status muda para EXPIRADO

    - CANCELADO_RETIRADA, // Pedido cancelado quando estava pronto para retirada antes de expirar (Penalização de 1 ponto)
        - O pedido pode ser cancelado pelo vendedor nessa etapa, antes de expirar.
        - O pedido de cancelamento pode ser feito por meio de contato externo (chat, email, telefone) e o vendedor pode atualizar o status para CANCELADO_RETIRADA

    - COMPLETADO, // Produto entregue
        - O cliente informou o código de compra e retirou o pedido e o vendedor atualizou o status para COMPLETADO
        - O pedido é finalizado e o valor é creditado na conta do vendedor

    - EXPIRADO, // Pedido expirado (Penalização de 2 pontos)
        - O pedido não foi retirado pelo cliente dentro do prazo estabelecido pelo vendedor
        - O pedido ainda pode permanecer nesse status pelo tempo de escolha do vendedor

    - COMPLETADO_EXPIRADO // Pedido completado após expiração (Mantém penalização de 2 pontos)
        - O cliente retirou o pedido após o status EXPIRADO
        - O vendedor atualiza o status manualmente para COMPLETADO_EXPIRADO
        - O valor é creditado normalmente na conta do vendedor
        - Um admin pode auditar a penalização do cliente, se necessário

    - SEM_RETIRADA // Pedido não retirado pelo cliente (Penalização de 3 pontos)
        - O pedido não foi retirado pelo cliente dentro do prazo estabelecido pelo vendedor (Não houve tentativa de contato ou o produto ficou retido por muito tempo)
        - O pedido não pode mais ser completado e fica nesse status permanentemente
    
- Os status não devem estar todos disponíveis de uma vez
- Cada status deve ser alterado conforme o fluxo definido acima
- Maneiras de implementar esse fluxo de forma bem estruturada:
    - Criar um serviço dedicado para gerenciar as mudanças de status, encapsulando a lógica de negócio
    - Validar todas as condições necessárias antes de permitir a mudança de status
    - O service deve ser responsável por listar e alterar os status possíveis para o pedido, baseado no status atual e verificações secundárias
        - RECUPERAÇÃO DE STATUS PERMITIDOS:
            - Todos os status tem uma lista de status permitidos para mudança
            - Cada status pode ter verificações adicionais para permitir a mudança
            - Verificações adicionais por status:
                - COMPLETADO:
                    - Verificar código de confirmação
                    - Atualizar saldo do vendedor
                - EXPIRADO:
                    - Verificar se o prazo de retirada expirou
                - EXPIRADO_COMPLETADO:
                    - Verificar código de confirmação

        - ALTERAÇÃO DE STATUS:
            - Receber o ID do pedido
            - Receber o ID do cliente do pedido (sempre verificar se o cliente é o dono do pedido)
            - Receber o status desejado para mudança
            - Validar se o pedido pertence ao cliente
            - Validar se a mudança de status é permitida
            - Executar verificações adicionais conforme o status desejado
            - Atualizar o status do pedido
            - Persistir as mudanças no banco de dados
    